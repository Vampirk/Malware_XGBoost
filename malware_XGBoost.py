import pandas as pd
from sklearn.model_selection import train_test_split
from xgboost import XGBClassifier

# CSV 파일 로드
df = pd.read_csv('pe_info.csv')

# 널값에 'Unknown'으로 대체
df_filled = df.fillna('Unknown')

# 새로운 CSV 파일로 저장
df_filled.to_csv('pe_info_filled.csv', index=False)

# 대체된 CSV 파일 로드
df_filled = pd.read_csv('pe_info_filled.csv')

# 특성과 레이블 분리
X = df_filled.drop(columns=['Malicious'])  # 특성
y = df_filled['Malicious']  # 레이블
# 범주형 열을 원핫 인코딩으로 변환
X_encoded = pd.get_dummies(X)

# 대괄호와 부등호가 포함된 열 이름 찾기
columns_with_special_chars = [col for col in X_encoded.columns if '[' in col or ']' in col or '<' in col]

# 대괄호와 부등호가 포함된 열 이름 수정
for col in columns_with_special_chars:
    new_col_name = col.replace('[', '').replace(']', '').replace('<', '')  # 대괄호와 부등호 제거
    X_encoded.rename(columns={col: new_col_name}, inplace=True)

# 학습용과 테스트용 데이터 분리
X_train_encoded, X_test_encoded, y_train, y_test = train_test_split(X_encoded, y, test_size=0.2, random_state=42)

# XGBoost 모델 초기화 및 학습
model_encoded = XGBClassifier()
model_encoded.fit(X_train_encoded, y_train)

# 테스트 데이터로 모델 평가
accuracy_encoded = model_encoded.score(X_test_encoded, y_test)
print("Accuracy:", accuracy_encoded)

